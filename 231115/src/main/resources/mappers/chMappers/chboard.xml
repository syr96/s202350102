<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "//mybatis.org/DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.oracle.S202350102.chBoardMapper">
	<select id="noticeCount" parameterType="int" resultType="int">
		Select COUNT(*)
		From   board 
		Where brd_md= #{brd_md}
		and   brd_lg= 700 
	</select>
	
	<select id="noticeList" parameterType="Board" resultType="Board">
		
		Select *
		FROM	(Select rownum rn, b.brd_num, u.nick, b.title, b.reg_date, b.user_num, b.view_cnt
				From board b, user1 u
				Where brd_md= #{brd_md}
				and   brd_lg=700
				and   b.user_num = u.user_num
				Order By b.reg_date DESC)
		Where rn Between #{start} and #{end}
	</select>
	
	<insert id="noticeWrite" parameterType="Board">
		Insert Into board
			(brd_num, user_num, brd_lg, brd_md, title, conts, view_cnt, reg_date, brd_group, brd_step, img)
		values
			(BRD_NUM_SEQ.nextval, #{user_num}, 700, #{brd_md}, #{title}, #{conts}, 0, sysdate, BRD_NUM_SEQ.CURRVAL, 0, #{img})
	</insert>
	
	<select id="noticeCont" parameterType="int" resultType="Board">
		Select b.*, u.nick
		From board b, user1 u
		Where b.brd_num = #{brd_num}
		and b.user_num = u.user_num	
	</select>
	
	<update id="noticeUpdate" parameterType="Board">
		Update board 
		set title = #{title}, conts=#{conts} <if test="img != null">,img = #{img}</if>
		Where brd_num = #{brd_num}
	</update>
	
	<delete id="deleteNotice" parameterType="int">
		Delete board
		Where brd_num = #{brd_num}
	</delete>
	
	<update id="noticeViewUp">
		Update board
		Set view_cnt = view_cnt+1
		Where brd_num = #{brd_num}
	</update>
	
	<select id="popBoardList" resultType="Board">
		Select ROWNUM, a.*
		From    (Select b.*, u.nick
			     From  board b, user1 u
			     Where brd_lg = 700
			     and   b.user_num = u.user_num
			     and   b.brd_md = 103
			     and   b.like_cnt is not null
			     ORDER BY like_cnt DESC) a
		WHERE rownum BETWEEN 1 and 5   
	</select>
	
	<select id="popShareList" resultType="Board">
		Select ROWNUM, a.*
		From    (Select b.*, u.nick
			     From  board b, user1 u
			     Where brd_lg = 700
			     and   b.user_num = u.user_num
			     and   b.brd_md = 102
			     and   b.like_cnt is not null
			     ORDER BY like_cnt DESC) a
		WHERE rownum BETWEEN 1 and 5   
	</select>
	
	
	<select id="BrdResult" parameterType="java.lang.String" resultType="Board">		
		SELECT b.*, user1.nick
        FROM board b
        JOIN user1 ON b.user_num = user1.user_num
        WHERE b.brd_md = 103
        AND	  b.brd_Group = b.brd_num
        AND   (b.title like '%' || #{srch_word} || '%' 
        	Or b.conts like '%' || #{srch_word} || '%')
        ORDER BY b.reg_date DESC
	</select>
	
	<select id="shrResult" parameterType="java.lang.String" resultType="Board">		
		SELECT b.*, user1.nick
        FROM board b
        JOIN user1 ON b.user_num = user1.user_num
        WHERE b.brd_md = 102
        AND	  b.brd_Group = b.brd_num
        AND   (b.title like '%' || #{srch_word} || '%' 
        	Or user1.nick like '%' || #{srch_word} || '%')
        ORDER BY b.reg_date DESC
	</select>
	
	<select id="alarmchk" parameterType="int" resultType="BoardReChk">
		Select c.*, b.title
		From   board_re_chk c, board b 
		where  c.send_date= 1
		and    c.brd_num = b.brd_num
		and    c.user_num = #{user_num}
	</select>
	
	
	
	<select id="myCertiList" parameterType="int" resultType="Board">
		SELECT rownum, b.*, u.nick, c.title chg_title
		FROM board  b
		JOIN user1 u On b.user_num = u.user_num
		JOIN challenge  c ON b.chg_id = c.chg_id
		WHERE b.user_num = #{user_num}
		AND b.brd_md = 100
		and b.brd_step = 0
		ORDER BY b.reg_date DESC
		between rn 1 and 5
	</select>
	
	<select id="myReviewList" parameterType="int" resultType="Board">
		SELECT b.*, u.nick, c.title chg_title
		FROM board  b
		JOIN user1 u On b.user_num = u.user_num
		JOIN challenge  c ON b.chg_id = c.chg_id
		WHERE b.user_num = #{user_num}
		AND b.brd_md = 101
		and b.brd_step = 0
		ORDER BY b.reg_date DESC
	</select>
	
	<select id="myShareList" parameterType="int" resultType="Board">
		SELECT b.*, u.nick
		FROM board  b
		JOIN user1 u On b.user_num = u.user_num
		WHERE b.user_num = #{user_num}
		AND b.brd_md = 102
		and b.brd_step = 0
		ORDER BY b.reg_date DESC
	</select>
	
	<select id="myCommuList" parameterType="Board" resultType="Board">
		Select c.*
		From (Select rownum rn, a.*
		       from    (SELECT  b.*, u.nick
		                FROM board  b
		                JOIN user1 u On b.user_num = u.user_num
		                WHERE b.user_num = #{user_num}
		                AND b.brd_md = #{brd_md}
		                and b.brd_step = 0
		                ORDER BY b.reg_date DESC) a) c
		Where rn BETWEEN #{start} and #{end}           
	</select>
	
	<update id="readAlarm" parameterType="BoardReChk">
		Update BOARD_RE_CHK
		Set SEND_DATE = 2, read_date=sysdate
		Where user_num = #{user_num}
		AND re_step = #{re_step}
	</update>
	
	<update id="moveToNewCmt" parameterType="BoardReChk">
		Update BOARD_RE_CHK
		Set SEND_DATE = 2, read_date=sysdate
		Where user_num = #{user_num}
		AND brd_num = #{brd_num}
	</update>
	
	<select id="myCount" parameterType="int" resultType="com.oracle.S202350102.service.hbService.Paging">
		Select count(*) total, brd_md
		From board
		Where user_num = #{user_num}
		and brd_step = 0
		Group BY brd_md
	</select>
	
	<select id="mychgBoardList" parameterType="Board" resultType="Board">
		Select d.*       
		From       (Select rownum rn, a.*
		             From    (Select b.*, u.nick, c.title chg_title
		                        FROM board b
							    JOIN User1 u ON b.user_num = u.user_num
							    JOIN challenge c ON b.chg_id = c.chg_id
		                        Where b.brd_md = #{brd_md}
		                        and b.user_num = #{user_num}
		                        and b.brd_step = 0
		                        ORDER by b.reg_date DESC) a ) d
		Where rn BETWEEN #{start} and #{end}
	</select>
	
	<select id="userTot" parameterType="Board" resultType="int">
		Select Count(*)
		From board
		Where user_num = #{user_num}
		and brd_md = #{brd_md}
		and brd_step =0
	</select>
	
</mapper>